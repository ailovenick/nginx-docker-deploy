# === Модульная конфигурация для PHP-FPM ===
# Этот файл подключается внутри location ~ \.php$ или напрямую в server блоке.

location ~ \.php$ {
    # Если файл не найден, возвращаем 404
    try_files $uri =404;

    # Разбиение пути для PATH_INFO
    fastcgi_split_path_info ^(.+\.php)(/.+)$;

    # Адрес сервиса PHP. 
    # "php" - это имя сервиса в docker-compose.yml
    fastcgi_pass php:9000;

    # Индексный файл
    fastcgi_index index.php;

    # Подключение стандартных параметров
    include fastcgi_params;

    # Настройка путей. 
    # $document_root берется из директивы root в server блоке.
    # Важно: путь /var/www/html должен быть одинаковым и в контейнере nginx, и в php.
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_path_info;
}
